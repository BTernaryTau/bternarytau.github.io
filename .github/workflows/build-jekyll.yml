name: Build and Deploy to Github Pages

on:
    push:
        branches:
            - release

jobs:
    build_and_deploy:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v3
                with:
                    # The checkout action doesn't provide a way to get all commit history for a single branch
                    # So we use the magic number 2147483647 here which means infinite depth for git fetch
                    # See https://github.com/actions/checkout/issues/520, https://stackoverflow.com/a/6802238
                    fetch-depth: 2147483647

            # Use GitHub Actions' cache to cache dependencies on servers
            - uses: actions/cache@v3
                with:
                    path: vendor/bundle
                    key: ${{ runner.os }}-gems-${{ hashFiles('**/Gemfile.lock') }}
                    restore-keys: |
                        ${{ runner.os }}-gems-

            # Use GitHub Deploy Action to build and deploy to Github
            - uses: jeffreytse/jekyll-deploy-action@v0.4.0
                with:
                    provider: 'github'
                    token: ${{ secrets.GITHUB_TOKEN }}                        # It's your Personal Access Token(PAT)
                    repository: ''                                            # Default is current repository
                    branch: 'gh-pages'                                        # Default is gh-pages for github provider
                    jekyll_src: './'                                          # Default is root directory
                    jekyll_cfg: '_config.yml'                                 # Default is _config.yml
                    jekyll_baseurl: ''                                        # Default is according to _config.yml
                    bundler_ver: '>=0'                                        # Default is latest bundler version
                    cname: ''                                                 # Default is to not use a cname
                    actor: ''                                                 # Default is the GITHUB_ACTOR
                    pre_build_commands: 'pacman -S --noconfirm nodejs npm'    # Installing additional dependencies (Arch Linux)
